

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Genetic Algorithms &#8212; AI Search Algorithms for Smart Mobility</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/EvolutionaryComputingAlgorithms/GeneticAlgorithms';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Swarm Intelligence Algorithms" href="../SwarmIntelligenceAlgorithms/index.html" />
    <link rel="prev" title="Generating Initial Populations" href="GeneratingInitialPopulations.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/sm.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/sm.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    AI Search Algorithms for Smart Mobility - ECE1724
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../GettingStarted/index.html">Getting Started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../IntroGeoScience/index.html">Introduction to Geospatial Data Science</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../IntroGeoScience/SpatialData.html">Spatial Data and Geographic Information System (GIS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../IntroGeoScience/Projection.html">Projection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../IntroGeoScience/Visualization.html">Visualization</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../GraphSearchAlgorithms/index.html">Graph Search Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../GraphSearchAlgorithms/RoadGraph.html">From Road Network to Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GraphSearchAlgorithms/GraphSearch.html">Graph Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GraphSearchAlgorithms/BlindSearch.html">Blind Search Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GraphSearchAlgorithms/InformedSearch.html">Informed Search Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GraphSearchAlgorithms/SearchComparison.html">Search Algorithm Comparison</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../TrajectoryAlgorithms/index.html">Trajectory-based Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../TrajectoryAlgorithms/TabuSearch.html">Tabu Search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../TrajectoryAlgorithms/SimulatedAnnealing.html">Simulated Annealing</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Evolutionary Computing Algorithms</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="GeneratingInitialPopulations.html">Generating Initial Populations</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Genetic Algorithms</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../SwarmIntelligenceAlgorithms/index.html">Swarm Intelligence Algorithms</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../SwarmIntelligenceAlgorithms/ParticleSwarmOptimization.html">Particle Swarm Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../SwarmIntelligenceAlgorithms/AntColonyOptimization.html">Ant Colony Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../SwarmIntelligenceAlgorithms/ArtificialBeeColony.html">Artificial Bee Colony</a></li>
<li class="toctree-l2"><a class="reference internal" href="../SwarmIntelligenceAlgorithms/FireflyAlgorithm.html">Firefly Algorithm</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../LearnToSearch/index.html">Learn to Search</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../LearnToSearch/GeometricDeepLearning.html">Geometric Deep Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../LearnToSearch/GraphNeuralNetworks.html">Graph Neural Networks (GNN)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../LearnToSearch/AttentionMechanisms.html">Attention Mechanisms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../LearnToSearch/ReinforcementLearning.html">Reinforcement Learning</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../PeopleMobilityProblems/index.html">People Mobility Problems</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../PeopleMobilityProblems/carsharing/CarSharing.html">Car-Sharing Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PeopleMobilityProblems/trip_itinerary_planning/TIP.html">Trip Itinerary Planning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PeopleMobilityProblems/multicriteriarouting/MultiCriteriaRouting.html">Multi-Criteria Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../PeopleMobilityProblems/deadheading/Deadheading.html">Deadheading in Ride-Hailing</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../LogisticsProblems/index.html">Logistics Problems</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../LogisticsProblems/delivery_GA.html">Delivery Vehicle Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../LogisticsProblems/eco_routing.html">Eco-efficient Delivery</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../InfrastructureProblems/index.html">Infrastructure Problems</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../InfrastructureProblems/emergency_vehicle/emergency_vehicle.html">Emergency Dispatch and Routing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ToolsAndPythonLibraries/index.html">Tools and Python Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Datasets.html">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../References.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/SmartMobilityAlgorithms/book" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/EvolutionaryComputingAlgorithms/GeneticAlgorithms.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Genetic Algorithms</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-bike-pricing-using-simple-genetic-algorithm">Example: Bike pricing using Simple Genetic Algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-population">Initial Population</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fitness-function">Fitness Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parent-selection-crossover-and-mutation">Parent Selection, Crossover, and Mutation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solution-function">Solution Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-and-visualization">Results and Visualization</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-bike-pricing-using-real-valued-genetic-algorithm">Example: Bike pricing using Real-valued Genetic Algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-permutation-genetic-algorithm-for-tsp">Example: Permutation Genetic Algorithm for TSP</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#crossover-operators">Crossover operators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mutation-operators">Mutation Operators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partially-mapped-crossover">Partially-mapped crossover</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#edge-recombination-crossover">Edge recombination crossover</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#order-1-crossover">Order 1 crossover</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#insert-mutation">Insert Mutation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#swap-mutation">Swap Mutation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-permutation-genetic-algorithm-for-routing-problem">Example: Permutation Genetic Algorithm for Routing Problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-algorithm">The Algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mutation">Mutation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#crossover">Crossover</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#duplicates">Duplicates</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-code">The code</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="genetic-algorithms">
<h1>Genetic Algorithms<a class="headerlink" href="#genetic-algorithms" title="Permalink to this heading">#</a></h1>
<p>The genetic algorithm is a probabilistic search algorithm that iteratively transforms a set (called a population) of mathematical objects (typically fixed-length binary character strings), each with an associated fitness value, into a new population of offspring objects using the Darwinian principle of natural selection and using operations that are patterned after naturally occurring genetic operations, such as crossover (sexual recombination) and mutation.)</p>
<p>In this section, we will demonstrate some basic implementations of Simple Genetic Algorithms (SGA), Real-valued GA, as well as the use of GA to generate permutations. At the end, we’ll show how real-valued GA can be applied to a shortest-path search.</p>
<section id="example-bike-pricing-using-simple-genetic-algorithm">
<h2>Example: Bike pricing using Simple Genetic Algorithm<a class="headerlink" href="#example-bike-pricing-using-simple-genetic-algorithm" title="Permalink to this heading">#</a></h2>
<p>Assume that a company wants to design a new bicycle, and needs to consider the following costs:</p>
<ul class="simple">
<li><p>$700,000 for manufacturing setup, marketing, etc.</p></li>
<li><p>$110 for each bike produced</p></li>
</ul>
<p>Based on similar bikes, the company expects sales to follow this demand curve:</p>
<p><span class="math notranslate nohighlight">\(Q= 70,000 - 200P\)</span>,<br>
where <span class="math notranslate nohighlight">\(P\)</span> is the price, and <span class="math notranslate nohighlight">\(Q\)</span> is the number of units sold at that price</p>
<p>For example:</p>
<ul class="simple">
<li><p>At $0, the company would give away 70,000 bikes for free</p></li>
<li><p>At $300, the company would sell <span class="math notranslate nohighlight">\(70,000-200*300=10,000\)</span> bikes</p></li>
<li><p>At $350, the company wouldn’t sell at anything at all.</p></li>
</ul>
<p>Profit would be calculated as following:</p>
<p><span class="math notranslate nohighlight">\(Profit=Sales-Costs\)</span><br>
<span class="math notranslate nohighlight">\(Profit=P(70,000-200P)-(700,000+110(70,000-200P))\)</span><br>
<span class="math notranslate nohighlight">\(Profit=-200P^2+92,000P-8,400,000\)</span></p>
<p>Simple Genetic Algorithms represent genes as binary values, and mutates those genes through binary operations. Essentially, they replicate the behaviour of genotypes in genetics, where genotypes (actual DNA coding) produce phenotypes (genetic traits).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<section id="initial-population">
<h3>Initial Population<a class="headerlink" href="#initial-population" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate an initial random population</span>
<span class="k">def</span> <span class="nf">init_pop</span><span class="p">(</span><span class="n">pop_size</span><span class="p">,</span> <span class="n">chromosome_length</span><span class="p">):</span>
    <span class="n">ints</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">350</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pop_size</span><span class="p">)]</span>
    <span class="n">strs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">bin</span><span class="p">(</span><span class="n">n</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">chromosome_length</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ints</span><span class="p">]</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">strs</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">bins</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="fitness-function">
<h3>Fitness Function<a class="headerlink" href="#fitness-function" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For a given population, calculate the fitness of each element in the population</span>
<span class="k">def</span> <span class="nf">fitness_score</span><span class="p">(</span><span class="n">population</span><span class="p">):</span>
    <span class="n">fitness_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">num</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">)):</span>
        <span class="n">num</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">population</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">base</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># convert binary to decimal</span>
        <span class="n">fitness_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">200</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">92000</span> <span class="o">*</span> <span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">8400000</span><span class="p">)</span>
    <span class="n">tuples</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fitness_values</span><span class="p">,</span><span class="n">population</span><span class="p">),</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">fitness_values</span><span class="p">,</span> <span class="n">population</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tuples</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">fitness_values</span><span class="p">,</span> <span class="n">population</span>
</pre></div>
</div>
</div>
</div>
<p>This fitness function essentially determines how “good” a particular offspring is. It first converts each unit in the population to a binary number (the genotype), and then returns the “best” offspring.</p>
</section>
<section id="parent-selection-crossover-and-mutation">
<h3>Parent Selection, Crossover, and Mutation<a class="headerlink" href="#parent-selection-crossover-and-mutation" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Random parent selection</span>
<span class="k">def</span> <span class="nf">select_parent</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">num_parents</span><span class="p">):</span>
    <span class="n">parents</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">num_parents</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parents</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply 1-point crossover</span>
<span class="k">def</span> <span class="nf">crossover</span><span class="p">(</span><span class="n">parents</span><span class="p">,</span> <span class="n">crossover_prob</span><span class="p">):</span> 
    <span class="n">chromosome_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="k">if</span> <span class="n">crossover_prob</span> <span class="o">&gt;</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">():</span>
        <span class="n">cross_point</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">chromosome_length</span><span class="p">)</span>
        <span class="n">parents</span><span class="o">+=</span> <span class="nb">tuple</span><span class="p">([(</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">cross_point</span> <span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">cross_point</span><span class="o">+</span><span class="mi">1</span><span class="p">:(</span><span class="n">chromosome_length</span><span class="o">+</span><span class="mi">1</span><span class="p">)])])</span>
        <span class="n">parents</span><span class="o">+=</span> <span class="nb">tuple</span><span class="p">([(</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">cross_point</span> <span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span><span class="n">parents</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">cross_point</span><span class="o">+</span><span class="mi">1</span><span class="p">:(</span><span class="n">chromosome_length</span><span class="o">+</span><span class="mi">1</span><span class="p">)])])</span>
    <span class="k">return</span> <span class="n">parents</span>
</pre></div>
</div>
</div>
</div>
<p>The crossover function here first determines if a crossover takes place (using the <code class="docutils literal notranslate"><span class="pre">crossover_prob</span></code>) and then selects a random crossover point in the chromosome. Using 1-point crossover, the bottom halves are switched the parents.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Alter each gene independently with a probability mutation_prob</span>
<span class="k">def</span> <span class="nf">mutation</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">mutation_prob</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">chromosome_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">population</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chromosome_length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">mutation_prob</span> <span class="o">&gt;</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">population</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">population</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">population</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">population</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="solution-function">
<h3>Solution Function<a class="headerlink" href="#solution-function" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">SGA</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">num_gen</span><span class="p">,</span> <span class="n">num_parents</span><span class="p">,</span> <span class="n">crossover_prob</span><span class="p">,</span> <span class="n">mutation_prob</span><span class="p">,</span> <span class="n">use_tqdm</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">best_solution</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">best_score</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">use_tqdm</span><span class="p">:</span> <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">num_gen</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_gen</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">use_tqdm</span><span class="p">:</span> <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="c1"># Get population fitness</span>
        <span class="n">scores</span><span class="p">,</span> <span class="n">population</span> <span class="o">=</span> <span class="n">fitness_score</span><span class="p">(</span><span class="n">population</span><span class="p">)</span>
        <span class="n">current_best_score</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">current_best_solution</span> <span class="o">=</span> <span class="n">population</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_best_score</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_best_score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span> 
            <span class="n">best_score</span> <span class="o">=</span> <span class="n">current_best_score</span>
            <span class="n">best_solution</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">copy</span><span class="p">(</span><span class="n">current_best_solution</span><span class="p">)),</span> <span class="n">base</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="n">select_parent</span><span class="p">(</span><span class="n">population</span><span class="p">,</span> <span class="n">num_parents</span><span class="p">)</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="n">crossover</span><span class="p">(</span><span class="n">parents</span><span class="p">,</span> <span class="n">crossover_prob</span><span class="p">)</span>
        <span class="n">population</span> <span class="o">=</span> <span class="n">mutation</span><span class="p">(</span><span class="n">population</span><span class="p">,</span><span class="n">mutation_prob</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_solution</span><span class="p">,</span> <span class="n">best_score</span><span class="p">,</span> <span class="n">states</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SGA Parameters</span>
<span class="n">num_gen</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">pop_size</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">crossover_prob</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">mutation_prob</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">num_parents</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Solution representation</span>
<span class="n">chromosome_length</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">best_score</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100000</span> 

<span class="c1"># Initialize the &quot;best solution&quot;</span>
<span class="n">population</span> <span class="o">=</span> <span class="n">init_pop</span><span class="p">(</span><span class="n">pop_size</span><span class="p">,</span> <span class="n">chromosome_length</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="results-and-visualization">
<h3>Results and Visualization<a class="headerlink" href="#results-and-visualization" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_solution</span><span class="p">,</span> <span class="n">best_score</span><span class="p">,</span> <span class="n">states</span> <span class="o">=</span> <span class="n">SGA</span><span class="p">(</span>
    <span class="n">population</span><span class="p">,</span> <span class="n">num_gen</span><span class="p">,</span> <span class="n">num_parents</span><span class="p">,</span> <span class="n">crossover_prob</span><span class="p">,</span> <span class="n">mutation_prob</span><span class="p">,</span> <span class="n">use_tqdm</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best Solution: </span><span class="si">{</span><span class="n">best_solution</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best Score: </span><span class="si">{</span><span class="n">best_score</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Generations&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cost&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "548090acf7a247ecb65813560a31c53a"}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best Solution: 230
Best Score: 2180000.0
</pre></div>
</div>
<img alt="../../_images/43e5d2e74dc9608931feaec6bd116957d72cf5c0dbfd3de4e18e918ce7af42a4.png" src="../../_images/43e5d2e74dc9608931feaec6bd116957d72cf5c0dbfd3de4e18e918ce7af42a4.png" />
</div>
</div>
<p>We can also easily verify that the solution is indeed <strong>230</strong>, as the maximum of the profit function (solution to the derivative) is 230:</p>
<p><span class="math notranslate nohighlight">\(Profit=-200P^2+92,000P-8,400,000\)</span><br>
<span class="math notranslate nohighlight">\(\frac{dP}{dProfit}=-400P + 92000\)</span><br>
Set <span class="math notranslate nohighlight">\(\frac{dP}{dProfit}=0\)</span><br>
<span class="math notranslate nohighlight">\(400P = 92000\)</span><br>
<span class="math notranslate nohighlight">\(P=230\)</span></p>
</section>
</section>
<section id="example-bike-pricing-using-real-valued-genetic-algorithm">
<h2>Example: Bike pricing using Real-valued Genetic Algorithm<a class="headerlink" href="#example-bike-pricing-using-real-valued-genetic-algorithm" title="Permalink to this heading">#</a></h2>
<p>We can also run the above example using real-values instead. For this example, we’ll use a solver to handle the population generation, mutation, and child creation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">ypstruct</span> <span class="kn">import</span> <span class="n">structure</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">Input In [10],</span> in <span class="ni">&lt;cell line: 2&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">ypstruct</span> <span class="kn">import</span> <span class="n">structure</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">math</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;ypstruct&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run Genetic Algorithm</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    
    <span class="c1"># Problem Information</span>
    <span class="n">costfunc</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">costfunc</span>
    <span class="n">nvar</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">nvar</span>
    <span class="n">varmin</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">varmin</span>
    <span class="n">varmax</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">varmax</span>

    <span class="c1"># Parameters</span>
    <span class="n">maxit</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">maxit</span>
    <span class="n">npop</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">npop</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">beta</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pc</span>
    <span class="n">nc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">pc</span><span class="o">*</span><span class="n">npop</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">gamma</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">mu</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">sigma</span>

    <span class="c1"># Empty Individual Template</span>
    <span class="n">empty_individual</span> <span class="o">=</span> <span class="n">structure</span><span class="p">()</span>
    <span class="n">empty_individual</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">empty_individual</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Best Solution Ever Found</span>
    <span class="n">bestsol</span> <span class="o">=</span> <span class="n">empty_individual</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>
    <span class="n">bestsol</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="c1"># Initialize Population</span>
    <span class="n">pop</span> <span class="o">=</span> <span class="n">empty_individual</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">npop</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npop</span><span class="p">):</span>
        <span class="n">pop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">varmin</span><span class="p">,</span> <span class="n">varmax</span><span class="p">,</span> <span class="n">nvar</span><span class="p">)</span>
        <span class="n">pop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">costfunc</span><span class="p">(</span><span class="n">pop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">cost</span> <span class="o">&lt;</span> <span class="n">bestsol</span><span class="o">.</span><span class="n">cost</span><span class="p">:</span>
            <span class="n">bestsol</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>

    <span class="c1"># Best Cost of Iterations</span>
    <span class="n">bestcost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">maxit</span><span class="p">)</span>
    
    <span class="c1"># Main Loop</span>
    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">maxit</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="n">maxit</span><span class="p">):</span>

        <span class="n">costs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">cost</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">])</span>
        <span class="n">avg_cost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">costs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">avg_cost</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">costs</span> <span class="o">=</span> <span class="n">costs</span><span class="o">/</span><span class="n">avg_cost</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">*</span><span class="n">costs</span><span class="p">)</span>

        <span class="n">popc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>

            <span class="c1"># Select Parents</span>
            <span class="c1">#q = np.random.permutation(npop)</span>
            <span class="c1">#p1 = pop[q[0]]</span>
            <span class="c1">#p2 = pop[q[1]]</span>

            <span class="c1"># Perform Roulette Wheel Selection</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[</span><span class="n">roulette_wheel_selection</span><span class="p">(</span><span class="n">probs</span><span class="p">)]</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[</span><span class="n">roulette_wheel_selection</span><span class="p">(</span><span class="n">probs</span><span class="p">)]</span>
            
            <span class="c1"># Perform Crossover</span>
            <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">crossover</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>

            <span class="c1"># Perform Mutation</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">mutate</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="n">mutate</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>

            <span class="c1"># Apply Bounds</span>
            <span class="n">apply_bound</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">varmin</span><span class="p">,</span> <span class="n">varmax</span><span class="p">)</span>
            <span class="n">apply_bound</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">varmin</span><span class="p">,</span> <span class="n">varmax</span><span class="p">)</span>

            <span class="c1"># Evaluate First Offspring</span>
            <span class="n">c1</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">costfunc</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c1</span><span class="o">.</span><span class="n">cost</span> <span class="o">&lt;</span> <span class="n">bestsol</span><span class="o">.</span><span class="n">cost</span><span class="p">:</span>
                <span class="n">bestsol</span> <span class="o">=</span> <span class="n">c1</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>

            <span class="c1"># Evaluate Second Offspring</span>
            <span class="n">c2</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="n">costfunc</span><span class="p">(</span><span class="n">c2</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c2</span><span class="o">.</span><span class="n">cost</span> <span class="o">&lt;</span> <span class="n">bestsol</span><span class="o">.</span><span class="n">cost</span><span class="p">:</span>
                <span class="n">bestsol</span> <span class="o">=</span> <span class="n">c2</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>

            <span class="c1"># Add Offsprings to popc</span>
            <span class="n">popc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
            <span class="n">popc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
        

        <span class="c1"># Merge, Sort and Select</span>
        <span class="n">pop</span> <span class="o">+=</span> <span class="n">popc</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">cost</span><span class="p">)</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">npop</span><span class="p">]</span>

        <span class="c1"># Store Best Cost</span>
        <span class="n">bestcost</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">bestsol</span><span class="o">.</span><span class="n">cost</span>

    <span class="c1"># Output</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">structure</span><span class="p">()</span>
    <span class="n">out</span><span class="o">.</span><span class="n">pop</span> <span class="o">=</span> <span class="n">pop</span>
    <span class="n">out</span><span class="o">.</span><span class="n">bestsol</span> <span class="o">=</span> <span class="n">bestsol</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best solution: &quot;</span><span class="p">,</span> <span class="n">bestsol</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">bestcost</span> <span class="o">=</span> <span class="n">bestcost</span>
    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># perform single-point crossover</span>
<span class="k">def</span> <span class="nf">crossover</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">gamma</span><span class="p">,</span> <span class="mi">1</span><span class="o">+</span><span class="n">gamma</span><span class="p">,</span> <span class="o">*</span><span class="n">c1</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">c1</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">p1</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">p2</span><span class="o">.</span><span class="n">position</span>
    <span class="n">c2</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">p2</span><span class="o">.</span><span class="n">position</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">p1</span><span class="o">.</span><span class="n">position</span>
    <span class="k">return</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># apply mutation</span>
<span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">mu</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
    <span class="n">y</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">ind</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># apply boundary constraints</span>
<span class="k">def</span> <span class="nf">apply_bound</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">varmin</span><span class="p">,</span> <span class="n">varmax</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">varmin</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">varmax</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># roulette wheel selection</span>
<span class="k">def</span> <span class="nf">roulette_wheel_selection</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fitness function</span>
<span class="k">def</span> <span class="nf">bike_pricing</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">200</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">92000</span><span class="o">*</span><span class="n">X</span> <span class="o">+</span> <span class="mi">8400000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Problem Definition</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">structure</span><span class="p">()</span>
<span class="n">problem</span><span class="o">.</span><span class="n">costfunc</span> <span class="o">=</span> <span class="n">bike_pricing</span>
<span class="n">problem</span><span class="o">.</span><span class="n">nvar</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">problem</span><span class="o">.</span><span class="n">varmin</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">]</span>
<span class="n">problem</span><span class="o">.</span><span class="n">varmax</span> <span class="o">=</span> <span class="p">[</span><span class="mi">350</span><span class="p">]</span>

<span class="c1"># Solver GA Parameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">structure</span><span class="p">()</span>
<span class="n">params</span><span class="o">.</span><span class="n">maxit</span> <span class="o">=</span> <span class="mi">6000</span>
<span class="n">params</span><span class="o">.</span><span class="n">npop</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">params</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">params</span><span class="o">.</span><span class="n">pc</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">params</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">params</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">params</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run GA</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "cdfda69459a84df4bdbc83b149d3bd56", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best solution:  [219.49875272]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">bestcost</span><span class="p">)</span>
<span class="c1"># plt.semilogy(out.bestcost)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">maxit</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Iterations&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Best Cost&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Genetic Algorithm (GA)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/776fb1208c2aa8a99a3316b47f97cea85a37f667c0efd4ed20f6cd1dd1824230.png" src="../../_images/776fb1208c2aa8a99a3316b47f97cea85a37f667c0efd4ed20f6cd1dd1824230.png" />
</div>
</div>
</section>
<section id="example-permutation-genetic-algorithm-for-tsp">
<h2>Example: Permutation Genetic Algorithm for TSP<a class="headerlink" href="#example-permutation-genetic-algorithm-for-tsp" title="Permalink to this heading">#</a></h2>
<p>As you know by now, the Travelling Salesman Problem is essentially about generating the least costly permutation of all vertices in a graph. Assuming the graph is fully connected (every permutation is feasible), we can consider the following set of operators:</p>
<section id="crossover-operators">
<h3>Crossover operators<a class="headerlink" href="#crossover-operators" title="Permalink to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Adjacency-based operators</p>
<ul class="simple">
<li><p>Partially mapped crossover</p></li>
<li><p>Edge crossover</p></li>
</ul>
</li>
<li><p>Order-based operators</p>
<ul class="simple">
<li><p>Order 1 crossover</p></li>
<li><p>Cycle crossover</p></li>
</ul>
</li>
</ol>
</section>
<section id="mutation-operators">
<h3>Mutation Operators<a class="headerlink" href="#mutation-operators" title="Permalink to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Insert mutation</p></li>
<li><p>Swap mutation</p></li>
<li><p>Inversion mutation</p></li>
<li><p>Scramble mutation</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">smart_mobility_utilities.common</span> <span class="kn">import</span> <span class="n">random_tour</span><span class="p">,</span> <span class="n">cost_tour</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s generate a random connected graph, so that any permutation of vertices is feasible.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">complete_graph</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
    <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span> 
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/fab1ef1663b04d86ff1f05c72a4ad3b0c5a4a52b797e1d1825f75cd7214b4b2c.png" src="../../_images/fab1ef1663b04d86ff1f05c72a4ad3b0c5a4a52b797e1d1825f75cd7214b4b2c.png" />
</div>
</div>
<p>Let’s assume we can generate two random tours of the graph, and we now want to generate another permutation from these two parents. We can’t simply cut and paste or swap randomly, as that will likely generate a set that is not an actual and admissible permutation. For this reason, we need to consider the following crossover types that guarantee an acceptable permutation:</p>
</section>
<section id="partially-mapped-crossover">
<h3>Partially-mapped crossover<a class="headerlink" href="#partially-mapped-crossover" title="Permalink to this heading">#</a></h3>
<p>This algorithm is lightweight and disrupts a lot of the genes, which is a desirable effect for GA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">PMX_crossover</span><span class="p">(</span><span class="n">firstPermutation</span><span class="p">,</span> <span class="n">secondPermutation</span><span class="p">):</span>
    <span class="c1"># we need to know the length of either permutation</span>
    <span class="c1"># they must be equal in size</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">firstPermutation</span><span class="p">)</span>
    
    <span class="c1"># (1) choosing the two crossover points</span>
    <span class="c1">#     by randomly select a point from the</span>
    <span class="c1">#     first half and another point from the second half</span>
    <span class="n">first_Cross</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">second_Cross</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">length</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    
    <span class="c1"># (2) initializing the two equal sized segments</span>
    <span class="c1">#     and create another array with the same size of </span>
    <span class="c1">#     any permutation to be the child</span>
    <span class="n">child</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">length</span>
    <span class="n">subP1</span> <span class="o">=</span> <span class="n">firstPermutation</span><span class="p">[</span><span class="n">first_Cross</span><span class="p">:</span><span class="n">second_Cross</span><span class="p">]</span>
    <span class="n">subP2</span> <span class="o">=</span> <span class="n">secondPermutation</span><span class="p">[</span><span class="n">first_Cross</span><span class="p">:</span><span class="n">second_Cross</span><span class="p">]</span>
    
    <span class="c1"># (3) copy the elements in the segment from the first permutation</span>
    <span class="c1">#    into the same segment in the child</span>
    <span class="n">child</span><span class="p">[</span><span class="n">first_Cross</span><span class="p">:</span><span class="n">second_Cross</span><span class="p">]</span> <span class="o">=</span> <span class="n">subP1</span>
    
    <span class="c1"># (4) finding common elements in the segment from the</span>
    <span class="c1">#     the first permutation and the second permutation</span>
    <span class="c1">#     and get its mirror from first permutation to second</span>
    <span class="n">pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">subP2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subP1</span><span class="p">:</span>
            <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">element</span><span class="p">,</span> <span class="n">subP1</span><span class="p">[</span><span class="n">subP2</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">element</span><span class="p">)]))</span>
    
    <span class="c1"># (5) copying into the child all the elements in the segment</span>
    <span class="c1">#.    that are present in the first permutation segment but</span>
    <span class="c1">#.    aren&#39;t present in the second permutation segment.</span>
    <span class="c1">#.    if not we need to copy that element in place outside</span>
    <span class="c1">#     the segment in a place where we are sure that would</span>
    <span class="c1">#.    result into inadmissible permutations.</span>
    <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
        <span class="n">second</span> <span class="o">=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">second</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subP2</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">secondPermutation</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
            <span class="n">child</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># when there is an element from the segment of the first</span>
            <span class="c1"># permutation in the segment of the second permutation </span>
            <span class="n">reflect</span> <span class="o">=</span> <span class="n">firstPermutation</span><span class="p">[</span><span class="n">secondPermutation</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">second</span><span class="p">)]</span>
            
            <span class="c1"># bouncing back and forth between the two arrays indices</span>
            <span class="c1"># to get out of second permutation segment</span>
            <span class="k">while</span> <span class="n">reflect</span> <span class="ow">in</span> <span class="n">subP2</span><span class="p">:</span>
                <span class="n">bounce</span> <span class="o">=</span> <span class="n">reflect</span>
                <span class="n">reflect</span> <span class="o">=</span> <span class="n">firstPermutation</span><span class="p">[</span><span class="n">secondPermutation</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">bounce</span><span class="p">)]</span>
            <span class="n">child</span><span class="p">[</span><span class="n">secondPermutation</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">reflect</span><span class="p">)]</span> <span class="o">=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># (6) go through all the elements that have not been assigned</span>
    <span class="c1">#     yet in the child array and assign them with the second permutation</span>
    <span class="c1">#     elements</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">child</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">child</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">secondPermutation</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">child</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="edge-recombination-crossover">
<h3>Edge recombination crossover<a class="headerlink" href="#edge-recombination-crossover" title="Permalink to this heading">#</a></h3>
<p>The offspring of this crossover depends on the edges and connections between nodes in each permutation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ERO_crossover</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">firstPermutation</span><span class="p">,</span> <span class="n">secondPermutation</span><span class="p">):</span>
    <span class="c1"># constructing edge table</span>
    <span class="n">edgeTable</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">firstPermutation</span><span class="p">[:]</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
    
    <span class="c1"># just like adjacency list of nodes</span>
    <span class="c1"># in a given graph, but it is actually</span>
    <span class="c1"># the result of union between the two given</span>
    <span class="c1"># adjacency lists of a certain parent from both graphs</span>
    <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
        <span class="n">edgeTable</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">firstPermutationAdj</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">firstPermutation</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">source</span><span class="p">)]</span>
        <span class="n">secondPermutationAdj</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">secondPermutation</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">source</span><span class="p">)]</span>
        <span class="n">adjList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">()</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">firstPermutationAdj</span><span class="p">,</span> <span class="n">secondPermutationAdj</span><span class="p">))</span>
        <span class="n">edgeTable</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">=</span> <span class="n">adjList</span>

    <span class="n">child</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
    
    <span class="c1"># terminate when the length of the child is the same</span>
    <span class="c1"># as the length of their parent</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">:</span>
        <span class="n">child</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="c1"># remove the parent from all the adjacency lists</span>
        <span class="k">for</span> <span class="n">adjList</span> <span class="ow">in</span> <span class="n">edgeTable</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">adjList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="n">parentAdjList</span> <span class="o">=</span> <span class="n">edgeTable</span><span class="p">[</span><span class="n">parent</span><span class="p">][:]</span>
        <span class="k">del</span> <span class="n">edgeTable</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parentAdjList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">parentAdjList</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">parent</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgeTable</span><span class="p">[</span><span class="n">parent</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">child</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="order-1-crossover">
<h3>Order 1 crossover<a class="headerlink" href="#order-1-crossover" title="Permalink to this heading">#</a></h3>
<p>This is much simpler crossover technique. It involves copying a random segement of nodes from the first parent, and completes the child with any nodes in the second parent not already present in the child.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ordOne_crossover</span><span class="p">(</span><span class="n">firstPermutation</span><span class="p">,</span> <span class="n">secondPermutation</span><span class="p">):</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">firstPermutation</span><span class="p">)</span>
    
    <span class="c1"># choose the start and the end of the segment </span>
    <span class="c1"># to be copied from the first parent</span>
    <span class="n">start_Segment</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">end_Segment</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">length</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    
    <span class="c1"># create a child</span>
    <span class="n">child</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    
    <span class="c1"># add the randomaly selected segment from the first parent</span>
    <span class="n">child</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">firstPermutation</span><span class="p">[</span><span class="n">start_Segment</span><span class="p">:</span> <span class="n">end_Segment</span><span class="p">])</span>
    
    <span class="c1"># add what is left from the second parent that wasn&#39;t added from the first parent</span>
    <span class="n">residueFromSegment</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">secondPermutation</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">firstPermutation</span><span class="p">[</span><span class="n">start_Segment</span><span class="p">:</span> <span class="n">end_Segment</span><span class="p">]))</span>
    <span class="n">child</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">residueFromSegment</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">child</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="insert-mutation">
<h3>Insert Mutation<a class="headerlink" href="#insert-mutation" title="Permalink to this heading">#</a></h3>
<p>This mutation selects two random genes and moves the second to follow the first directly. This ensures a valid permutation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">insert_mutation</span><span class="p">(</span><span class="n">permutation</span><span class="p">):</span>
    <span class="c1"># copying the list so we don&#39;t mess with the original</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">permutation</span><span class="p">[:]</span>
    
    <span class="c1"># choose two random genes and make sure that they are different</span>
    <span class="n">first_gene</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
    <span class="n">second_gene</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">first_gene</span> <span class="o">==</span> <span class="n">second_gene</span><span class="p">:</span>
        <span class="n">first_gene</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="n">second_gene</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
    
    <span class="c1"># removing the second gene from the list and insert it just after the first</span>
    <span class="n">child</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">second_gene</span><span class="p">)</span>
    <span class="n">geneNewIndex</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">first_gene</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">child</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">geneNewIndex</span><span class="p">,</span> <span class="n">second_gene</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">child</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="swap-mutation">
<h3>Swap Mutation<a class="headerlink" href="#swap-mutation" title="Permalink to this heading">#</a></h3>
<p>This mutation simply exchanges the positions of two nodes in a permutation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">swap_mutation</span><span class="p">(</span><span class="n">permutation</span><span class="p">):</span>
    <span class="c1"># copying the list so we don&#39;t mess with the original</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">permutation</span><span class="p">[:]</span>

    <span class="n">length</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">child</span><span class="p">))</span>

    <span class="c1"># choose two random gene position so they could be swaped</span>
    <span class="n">first_gene_pos</span><span class="p">,</span> <span class="n">second_gene_pos</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># swapping </span>
    <span class="n">child</span><span class="p">[</span><span class="n">first_gene_pos</span><span class="p">],</span> <span class="n">child</span><span class="p">[</span><span class="n">second_gene_pos</span><span class="p">]</span> <span class="o">=</span>\
    <span class="n">child</span><span class="p">[</span><span class="n">second_gene_pos</span><span class="p">],</span> <span class="n">child</span><span class="p">[</span><span class="n">first_gene_pos</span><span class="p">]</span> 

    <span class="k">return</span> <span class="n">child</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="implementation">
<h3>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">#</a></h3>
<p>For this example, we’ll use Partially-mapped crossovers and Insert mutations, but others could be substituted as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># remember that ERO takes the graph as input</span>
<span class="c1"># not like PMX or Order 1</span>
<span class="n">crossover</span> <span class="o">=</span> <span class="n">PMX_crossover</span>
<span class="n">mutate</span> <span class="o">=</span> <span class="n">insert_mutation</span>

<span class="n">size_of_population</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">ngen</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">best_at_gen</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># for keeping track of the best tour at a given generation</span>

<span class="c1"># Initialize population</span>
<span class="n">pool</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">random_tour</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">number_of_perms</span><span class="o">=</span><span class="n">size_of_population</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">generation</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ngen</span><span class="p">)):</span>
    <span class="c1"># 1- crossover every consecutive pair of routes</span>
    <span class="c1"># 2- replace the weakest of the two parent with the product of the crossover</span>
    <span class="c1"># 3- mutate the whole pool</span>
    <span class="c1"># 4- repeat and save the value best tour in that generation</span>
    
    <span class="c1"># 1-</span>
    <span class="k">for</span> <span class="n">parent1</span><span class="p">,</span> <span class="n">parent2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">pool</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">child</span> <span class="o">=</span> <span class="n">crossover</span><span class="p">(</span><span class="n">parent1</span><span class="p">,</span> <span class="n">parent2</span><span class="p">)</span>
        
        <span class="c1"># 2-</span>
        <span class="k">if</span> <span class="n">cost_tour</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">parent1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cost_tour</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">parent2</span><span class="p">):</span>
            <span class="n">pool</span><span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">parent2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">child</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pool</span><span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">parent1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">child</span>
    
    <span class="c1"># 3-</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size_of_population</span><span class="p">):</span>
        <span class="n">pool</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mutate</span><span class="p">(</span><span class="n">pool</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="c1"># 4-</span>
    <span class="n">best_at_gen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cost_tour</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">tour</span> <span class="p">:</span> <span class="n">cost_tour</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">))))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f75f0e9342ab48719e918afc86428db9", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tour</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">route</span> <span class="p">:</span> <span class="n">cost_tour</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route</span><span class="p">))</span> <span class="c1"># result</span>
<span class="n">tour_cost</span> <span class="o">=</span> <span class="n">cost_tour</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">)</span> <span class="c1">#result cost</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;number of generation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;cost of the shortest tour (meters)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">best_at_gen</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3b8c4f65bbb1b878b7452afa2d799d1164671c6f7386abbe058da58be457958a.png" src="../../_images/3b8c4f65bbb1b878b7452afa2d799d1164671c6f7386abbe058da58be457958a.png" />
</div>
</div>
<p>As you may notice, there is not much convergence in the costs of the tours in this GA implementation. This is largely because the solutions of the problem are very close to each other (there is only a limited range of edge weights).</p>
</section>
</section>
<section id="example-permutation-genetic-algorithm-for-routing-problem">
<h2>Example: Permutation Genetic Algorithm for Routing Problem<a class="headerlink" href="#example-permutation-genetic-algorithm-for-routing-problem" title="Permalink to this heading">#</a></h2>
<p>For the examples in this section, we will move past our University of Toronto search space in the previous section in favour of a more complex environment. This is the kind of network which really benefits from Genetic Search Algorithms.</p>
<p>Let’s consider the road network in Vaughan, a municipality to the north of Toronto:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">osmnx</span>

<span class="n">G</span> <span class="o">=</span> <span class="n">osmnx</span><span class="o">.</span><span class="n">graph_from_address</span><span class="p">(</span><span class="s1">&#39;vaughan&#39;</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1400</span><span class="p">)</span>

<span class="n">origin</span> <span class="o">=</span> <span class="mi">29658954</span>
<span class="n">destination</span> <span class="o">=</span> <span class="mi">701446851</span>

<span class="n">highlighted</span> <span class="o">=</span> <span class="p">[</span><span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">]</span>

<span class="n">nc</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span> <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">highlighted</span> <span class="k">else</span> <span class="s1">&#39;#336699&#39;</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()]</span>
<span class="n">ns</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span> <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">highlighted</span> <span class="k">else</span> <span class="mi">8</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">osmnx</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">ns</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">node_zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/de0d647b536d7070aa29a0699e85a7b4880ec6dc11d491187b2c5669dfd0b5c7.png" src="../../_images/de0d647b536d7070aa29a0699e85a7b4880ec6dc11d491187b2c5669dfd0b5c7.png" />
</div>
</div>
<p>For this example, we’ll be attempting to search for the shortest route between two points highlighted in red.</p>
<section id="the-algorithm">
<h3>The Algorithm<a class="headerlink" href="#the-algorithm" title="Permalink to this heading">#</a></h3>
<p>There are many ways to design a genetic algorithm; the below is only one of them.</p>
<ol class="arabic simple">
<li><p>We will need a fitness function to determine which offspring to keep in each generation. This will be the length of the route generated (we want to minimize this).</p></li>
<li><p>As we will be doing a real-value (non-binary) GA, out phenotype is the same as our genotype.</p></li>
<li><p>Our GA implementation is “kind of” steady state: we probabilistically choose the best routes to be the parents of the next generation. More on this later.</p></li>
<li><p>We will be doing <a class="reference external" href="https://en.wikipedia.org/wiki/Crossover_(genetic_algorithm)#One-point_crossover">1-point crossover</a>.</p></li>
<li><p>Route mutations take place by deleting a random number of genes/nodes and trying to stitch that gap. Keep in mind this is time-intensive.</p></li>
<li><p>Selection is based on fitness-proportionate criteria.</p></li>
</ol>
<p>The actual algorithm (in pseudo-code) looks like this:</p>
<style>
i {font-weight:normal}
span {font-weight:normal}
</style>
<div style="background-color: rgba(0,0,0,0.0470588);padding:10px;font-family:monospace;">
    <b>GENETIC_ALGORITHM</b>(<i>source</i>,<i>destination</i>, <i>num_of_generations</i>. <i>pool_size</i>) <b>return</b> a <i>route</i>
    <div style='padding-left:20px;'>
        <i><font color="green">pool</font></i> &larr; <span>random-routes between <i>source</i> and <i>destination</i></span><br><br>
        for <i>num_of_generations</i> do<br>
        <div style='padding-left:20px;'>
            <i><font color="orange">parents_first_gen</font></i> &larr; <span>select number of best routes from <i><font color="green">pool</font></i></span><br>
            <i><font color="blue">parents_second_gen</font></i> &larr; <span>crossover <i><font color="orange">parents_first_gen</font></i></span><br>
            <i><font color="purple">parents</font></i> &larr; <span>mutate <i><font color="blue">parents_second_gen</font></i></span><br>
            <i><font color="green">pool</font></i> &larr; <span>offspring of <i><font color="purple">parents</font></i></span><br>
            remove duplicates from <i><font color="green">pool</font></i> and add random routes to compensate any removal<br>
        </div>
        endfor<br>
        <i>route</i> &larr; best <i>route</i> in <i><font color="green">pool</font></i><br>
        return <i>route</i>
    </div>
</div><section id="mutation">
<h4>Mutation<a class="headerlink" href="#mutation" title="Permalink to this heading">#</a></h4>
<p>Our algorithm “mutates” a child (route) by deleting a node between two nodes in the child, and attempting to fill in the gap with alternate nodes. If you recall the way we generated “children” for Beam Search and Hill climbing in previous sections, this uses the same idea.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smart_mobility_utilities.children</span> <span class="kn">import</span> <span class="n">shortest_path_with_failed_nodes_single</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route</span><span class="p">):</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">route</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">destination</span> <span class="o">=</span> <span class="n">route</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">failed</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">shortest_path_with_failed_nodes_single</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="p">[</span><span class="n">failed</span><span class="p">])</span>

    <span class="c1"># This method could fail because of a lot of factors relating to the graph structure</span>
    <span class="c1"># Check the documentation fo the shortest_path_with_failed_nodes to learn more</span>
    <span class="k">while</span> <span class="n">path</span> <span class="o">==</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
        <span class="n">failed</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">shortest_path_with_failed_nodes_single</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="p">[</span><span class="n">failed</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">path</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="crossover">
<h4>Crossover<a class="headerlink" href="#crossover" title="Permalink to this heading">#</a></h4>
<p>Rather than selecting a random point to “crossover”, we look for a common node between the two routes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">smart_mobility_utilities.common</span> <span class="kn">import</span> <span class="n">probability</span>

<span class="k">def</span> <span class="nf">cross_over</span><span class="p">(</span><span class="n">route_1</span><span class="p">,</span> <span class="n">route_2</span><span class="p">):</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="n">route_1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">destination</span> <span class="o">=</span> <span class="n">route_1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">intersection</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">itertools</span><span class="o">.</span><span class="n">filterfalse</span><span class="p">(</span>\
                    <span class="k">lambda</span> <span class="n">element</span> <span class="p">:</span> <span class="n">element</span> <span class="ow">in</span> <span class="p">[</span><span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">]</span> <span class="p">,</span>\
                    <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">route_1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">route_2</span><span class="p">)))]</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">route_1</span> <span class="c1"># if there is not common node, just return the first route</span>

    <span class="n">cross_over_point</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span>
    <span class="n">first_point</span> <span class="o">=</span> <span class="n">route_1</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cross_over_point</span><span class="p">)</span>
    <span class="n">second_point</span> <span class="o">=</span> <span class="n">route_2</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cross_over_point</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">probability</span><span class="p">(</span><span class="mf">0.50</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">route_1</span><span class="p">[:</span><span class="n">first_point</span><span class="p">]</span> <span class="o">+</span> <span class="n">route_2</span><span class="p">[</span><span class="n">second_point</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">route_2</span><span class="p">[:</span><span class="n">second_point</span><span class="p">]</span> <span class="o">+</span> <span class="n">route_1</span><span class="p">[</span><span class="n">first_point</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="duplicates">
<h4>Duplicates<a class="headerlink" href="#duplicates" title="Permalink to this heading">#</a></h4>
<p>Our offspring will likely result in many duplicates, as most routes will closely ressemble each other. To account for this, we remove any duplicates and replace them with new randomly generated routes. This also ensures population diversity.</p>
</section>
</section>
<section id="the-code">
<h3>The code<a class="headerlink" href="#the-code" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smart_mobility_utilities.common</span> <span class="kn">import</span> <span class="n">randomized_search</span>

<span class="c1"># Configure some parameters</span>
<span class="n">n_gen</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># Anything above 20 will take some time but yield much better results</span>
<span class="n">pool_size</span> <span class="o">=</span> <span class="mi">12</span> <span class="c1"># Number of routes in each generation</span>
<span class="n">parents_num</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1"># needs to be a factor of pool size</span>

<span class="c1"># Initialize the pool</span>
<span class="n">pool</span> <span class="o">=</span> <span class="p">[</span><span class="n">randomized_search</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">origin</span><span class="p">,</span><span class="n">destination</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pool_size</span><span class="p">)]</span>

<span class="c1"># Plot the pool on a map</span>
<span class="n">random_hexa</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">)</span> <span class="c1"># generate random hexadecimal color</span>
<span class="n">rc</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#</span><span class="si">%02X%02X%02X</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">random_hexa</span><span class="p">(),</span><span class="n">random_hexa</span><span class="p">(),</span><span class="n">random_hexa</span><span class="p">())</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pool_size</span><span class="p">)]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">osmnx</span><span class="o">.</span><span class="n">plot_graph_routes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pool</span><span class="p">,</span> <span class="n">route_colors</span><span class="o">=</span><span class="n">rc</span><span class="p">,</span> <span class="n">route_linewidth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8617e0a3f9b40f9fa0c84eb76f64b826806db8ae81ac6415b60acc2e3afed794.png" src="../../_images/8617e0a3f9b40f9fa0c84eb76f64b826806db8ae81ac6415b60acc2e3afed794.png" />
</div>
</div>
<p>The following code will take quite a bit of time to run.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">smart_mobility_utilities.common</span> <span class="kn">import</span> <span class="n">cost</span><span class="p">,</span> <span class="n">flatten</span>
<span class="kn">from</span> <span class="nn">smart_mobility_utilities.children</span> <span class="kn">import</span> <span class="n">get_children</span>
<span class="kn">import</span> <span class="nn">heapq</span>

<span class="n">states</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">select_best</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">num_of_choices</span><span class="p">,</span> <span class="n">probability_dist</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">population</span><span class="o">=</span><span class="n">pool</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">probability_dist</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span> <span class="n">num_of_choices</span><span class="p">)</span>


<span class="k">for</span> <span class="n">gen</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_gen</span><span class="p">)):</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route</span><span class="p">)</span> <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">pool</span><span class="p">]</span>
    <span class="n">parents_1</span> <span class="o">=</span> <span class="n">select_best</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">parents_num</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">parents_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">cross_over</span><span class="p">(</span><span class="n">route_1</span><span class="p">,</span> <span class="n">route_2</span><span class="p">)</span> <span class="k">for</span> <span class="n">route_1</span><span class="p">,</span> <span class="n">route_2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">parents_1</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)]</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">mutate</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route</span><span class="p">)</span> <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">parents_2</span><span class="p">])</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">pool</span><span class="p">))))]</span>
    <span class="n">num_removed</span> <span class="o">=</span> <span class="n">pool_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">randomized_search</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_removed</span><span class="p">)])</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">heapq</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="n">pool_size</span><span class="p">,</span><span class="n">pool</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">route</span> <span class="p">:</span> <span class="n">cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route</span><span class="p">)))</span>
    <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Retrieve the final best route</span>
<span class="n">route</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">route</span><span class="p">:</span> <span class="n">cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">route</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "618b4027b0fa46f784b3598b964cba71", "version_major": 2, "version_minor": 0}</script><div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_9506</span><span class="o">/</span><span class="mf">2180043652.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="n">parents_1</span> <span class="o">=</span> <span class="n">select_best</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">parents_num</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">parents_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">cross_over</span><span class="p">(</span><span class="n">route_1</span><span class="p">,</span> <span class="n">route_2</span><span class="p">)</span> <span class="k">for</span> <span class="n">route_1</span><span class="p">,</span> <span class="n">route_2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">parents_1</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)]</span>
<span class="ne">---&gt; </span><span class="mi">16</span>     <span class="n">pool</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">mutate</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route</span><span class="p">)</span> <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">parents_2</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="n">pool</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">pool</span><span class="p">))))]</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>     <span class="n">num_removed</span> <span class="o">=</span> <span class="n">pool_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="nn">/tmp/ipykernel_9506/2180043652.py</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="n">parents_1</span> <span class="o">=</span> <span class="n">select_best</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">parents_num</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">parents_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">cross_over</span><span class="p">(</span><span class="n">route_1</span><span class="p">,</span> <span class="n">route_2</span><span class="p">)</span> <span class="k">for</span> <span class="n">route_1</span><span class="p">,</span> <span class="n">route_2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">parents_1</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)]</span>
<span class="ne">---&gt; </span><span class="mi">16</span>     <span class="n">pool</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">mutate</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route</span><span class="p">)</span> <span class="k">for</span> <span class="n">route</span> <span class="ow">in</span> <span class="n">parents_2</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="n">pool</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">pool</span><span class="p">))))]</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>     <span class="n">num_removed</span> <span class="o">=</span> <span class="n">pool_size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="nn">/tmp/ipykernel_9506/672098679.py</span> in <span class="ni">mutate</span><span class="nt">(G, route)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">failed</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> 
<span class="ne">---&gt; </span><span class="mi">11</span>     <span class="n">path</span> <span class="o">=</span> <span class="n">shortest_path_with_failed_nodes_single</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="p">[</span><span class="n">failed</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> 
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="c1"># This method could fail because of a lot of factors relating to the graph structure</span>

<span class="nn">~/book-env/smart_mobility_utilities/smart_mobility_utilities/children.py</span> in <span class="ni">shortest_path_with_failed_nodes_single</span><span class="nt">(G, route, failed)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">j</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">route</span><span class="p">)</span> <span class="o">-</span><span class="mi">2</span>
<span class="ne">---&gt; </span><span class="mi">11</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">shortest_path_with_failed_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">route</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">failed</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span> <span class="k">return</span> <span class="n">result</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="n">path</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">result</span>

<span class="nn">~/book-env/smart_mobility_utilities/smart_mobility_utilities/children.py</span> in <span class="ni">shortest_path_with_failed_nodes</span><span class="nt">(G, route, i, j, failed)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> 
<span class="g g-Whitespace">     </span><span class="mi">48</span>     <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">unrelaxed_nodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">49</span>         <span class="n">node</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">unrelaxed_nodes</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span> <span class="p">:</span> <span class="n">shortest_dist</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span> 
<span class="g g-Whitespace">     </span><span class="mi">51</span>         <span class="c1"># if we have relaxed articulation nodes in our graph</span>

<span class="nn">~/book-env/smart_mobility_utilities/smart_mobility_utilities/children.py</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(node)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> 
<span class="g g-Whitespace">     </span><span class="mi">48</span>     <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">unrelaxed_nodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">49</span>         <span class="n">node</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">unrelaxed_nodes</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span> <span class="p">:</span> <span class="n">shortest_dist</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span> 
<span class="g g-Whitespace">     </span><span class="mi">51</span>         <span class="c1"># if we have relaxed articulation nodes in our graph</span>

<span class="nn">~/book-env/smart_mobility_utilities/smart_mobility_utilities/common.py</span> in <span class="ni">__eq__</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span>             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">osmid</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">osmid</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span>         <span class="k">except</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">59</span>             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">osmid</span> <span class="o">==</span> <span class="n">other</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span> 
<span class="g g-Whitespace">     </span><span class="mi">61</span> 

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">smart_mobility_utilities.viz</span> <span class="kn">import</span> <span class="n">draw_route</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cost of the route:&quot;</span><span class="p">,</span><span class="n">cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">route</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">draw_route</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">route</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content\EvolutionaryComputingAlgorithms"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="GeneratingInitialPopulations.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Generating Initial Populations</p>
      </div>
    </a>
    <a class="right-next"
       href="../SwarmIntelligenceAlgorithms/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Swarm Intelligence Algorithms</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-bike-pricing-using-simple-genetic-algorithm">Example: Bike pricing using Simple Genetic Algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-population">Initial Population</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fitness-function">Fitness Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parent-selection-crossover-and-mutation">Parent Selection, Crossover, and Mutation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solution-function">Solution Function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results-and-visualization">Results and Visualization</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-bike-pricing-using-real-valued-genetic-algorithm">Example: Bike pricing using Real-valued Genetic Algorithm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-permutation-genetic-algorithm-for-tsp">Example: Permutation Genetic Algorithm for TSP</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#crossover-operators">Crossover operators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mutation-operators">Mutation Operators</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partially-mapped-crossover">Partially-mapped crossover</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#edge-recombination-crossover">Edge recombination crossover</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#order-1-crossover">Order 1 crossover</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#insert-mutation">Insert Mutation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#swap-mutation">Swap Mutation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-permutation-genetic-algorithm-for-routing-problem">Example: Permutation Genetic Algorithm for Routing Problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-algorithm">The Algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#mutation">Mutation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#crossover">Crossover</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#duplicates">Duplicates</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-code">The code</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Alaa Khamis and Yinan Wang
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2021, Alaa Khamis and Yinan Wang.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>